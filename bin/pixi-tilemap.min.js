!function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return n(r?r:e)},l,l.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t,r){function i(e){this.renderer=e,this.tileAnim=[0,0]}PIXI.CanvasRenderer.registerPlugin("tile",i),t.exports=i},{}],2:[function(e,t,r){function i(){PIXI.Container.apply(this,arguments),this.initialize.apply(this,arguments)}var n=e("./RectTileLayer");i.prototype=Object.create(PIXI.Container.prototype),i.prototype.constructor=n,i.prototype.updateTransform=i.prototype.displayObjectUpdateTransform,i.prototype.initialize=function(e,t,r){this.z=this.zIndex=e,this.useSquare=r,this.shadowColor=new Float32Array([0,0,0,.5]),t&&this.setBitmaps(t)},i.prototype.setBitmaps=function(e){this.removeChildren(),this.addChild(new n(this.zIndex,e)),this.modificationMarker=0},i.prototype.clear=function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.modificationMarker=0},i.prototype.addRect=function(e,t,r,i,n,o,a){this.children[e]&&this.children[e].textures&&this.children[e].addRect(0,t,r,i,n,o,a)},i.prototype.addFrame=function(e,t,r){"string"==typeof e&&(e=PIXI.Texture.fromImage(e));for(var i=this.children,o=null,a=0,s=0;s<i.length;s++){for(var h=i[s].textures,u=0;u<h.length;u++)if(h[u].baseTexture==e.baseTexture){o=i[s],a=u;break}if(o)break}if(!o){for(s=0;s<i.length;s++){var l=i[s];l.textures.length<16&&(o=l,a=l.textures.length,l.textures.push(e))}o||(i.push(o=new n(this.zIndex,e)),a=0)}return o.addRect(a,e.frame.x,e.frame.y,t,r,e.frame.width,e.frame.height),!0},i.prototype.renderCanvas=function(e){if(!e.dontUseTransform){var t=this.worldTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution)}for(var r=this.children,i=0;i<r.length;i++)r[i].renderCanvas(e)},i.prototype.renderWebGL=function(e){var t=(e.gl,e.plugins.tile.getShader(this.useSquare));if(e.setObjectRenderer(e.plugins.tile),e.bindShader(t),this._globalMat=this._globalMat||new PIXI.Matrix,e._activeRenderTarget.projectionMatrix.copy(this._globalMat).append(this.worldTransform),t.uniforms.projectionMatrix=this._globalMat.toArray(!0),t.uniforms.shadowColor=this.shadowColor,this.useSquare){var r=this._tempScale=this._tempScale||[0,0];r[0]=this._globalMat.a>=0?1:-1,r[1]=this._globalMat.d<0?1:-1;t.uniforms.pointScale=r;t.uniforms.projectionScale=Math.abs(this.worldTransform.a)*e.resolution}for(var i=(t.uniforms.animationFrame=e.plugins.tile.tileAnim,this.children),n=0;n<i.length;n++)i[n].renderWebGL(e,this.useSquare)},i.prototype.isModified=function(e){var t=this.children;if(this.modificationMarker!=t.length)return!0;for(var r=0;r<t.length;r++)if(t[r].modificationMarker!=t[r].pointsBuf.length||e&&t[r].hasAnim)return!0;return!1},i.prototype.clearModify=function(){var e=this.children;this.modificationMarker=e.length;for(var t=0;t<e.length;t++)e[t].modificationMarker=e[t].pointsBuf.length},t.exports=i},{"./RectTileLayer":4}],3:[function(e,t,r){function i(e){PIXI.Graphics.apply(this,arguments),this.z=this.zIndex=e}i.prototype=Object.create(PIXI.Graphics.prototype),i.prototype.constructor=i,i.prototype.renderCanvas=function(e){var t=null;e.dontUseTransform&&(t=this.transform.worldTransform,this.transform.worldTransform=PIXI.Matrix.IDENTITY),e.plugins.graphics.render(this),e.dontUseTransform&&(this.transform.worldTransform=t),e.context.globalAlpha=1},i.prototype.renderWebGL=function(e){this._webGL[e.gl.id]||(this.dirty=!0),PIXI.Graphics.prototype.renderWebGL.call(this,e)},i.prototype.isModified=function(e){return!1},i.prototype.clearModify=function(){},t.exports=i},{}],4:[function(e,t,r){function i(e,t){PIXI.DisplayObject.apply(this,arguments),this.initialize.apply(this,arguments)}i.prototype=Object.create(PIXI.DisplayObject.prototype),i.prototype.constructor=i,i.prototype.initialize=function(e,t){t?t instanceof Array||!t.baseTexture||(t=[t]):t=[],this.textures=t,this.z=this.zIndex=e,this.pointsBuf=[],this.visible=!1,this._tempSize=new Float32Array([0,0]),this._tempTexSize=1},i.prototype.clear=function(){this.pointsBuf.length=0,this.modificationMarker=0,this.hasAnim=!1},i.prototype.renderCanvas=function(e){if(0!==this.textures.length){var t=this.pointsBuf;e.context.fillStyle="#000000";for(var r=0,i=t.length;i>r;r+=9){var n=t[r],o=t[r+1],a=t[r+2],s=t[r+3],h=t[r+4],u=t[r+5];n+=t[r+6]*e.plugins.tile.tileAnim[0],o+=t[r+7]*e.plugins.tile.tileAnim[1];var l=t[r+8];l>=0?e.context.drawImage(this.textures[l].baseTexture.source,n,o,h,u,a,s,h,u):(e.context.globalAlpha=.5,e.context.fillRect(a,s,h,u),e.context.globalAlpha=1)}}},i.prototype.addRect=function(e,t,r,i,n,o,a,s,h){var u=this.pointsBuf;if(this.hasAnim=this.hasAnim||s>0||h>0,o==a)u.push(t),u.push(r),u.push(i),u.push(n),u.push(o),u.push(a),u.push(0|s),u.push(0|h),u.push(e);else{var l;if(o%a===0)for(l=0;o/a>l;l++)u.push(t+l*a),u.push(r),u.push(i+l*a),u.push(n),u.push(a),u.push(a),u.push(0|s),u.push(0|h),u.push(e);else if(a%o===0)for(l=0;a/o>l;l++)u.push(t),u.push(r+l*o),u.push(i),u.push(n+l*o),u.push(o),u.push(o),u.push(0|s),u.push(0|h),u.push(e);else u.push(t),u.push(r),u.push(i),u.push(n),u.push(o),u.push(a),u.push(0|s),u.push(0|h),u.push(e)}},i.prototype.renderWebGL=function(e,t){var r=this.pointsBuf;if(0!==r.length){var i=e.plugins.tile,n=e.gl,o=i.getShader(t),a=this.textures;if(0!==a.length){var s=a.length;this._tempTexSize<o.maxTextures&&(this._tempTexSize=o.maxTextures,this._tempSize=new Float32Array(2*o.maxTextures));for(var h=0;s>h;h++){if(!a[h]||!a[h].valid)return;a[h].baseTexture}i.bindTextures(e,a);var u=i.getVb(this.vbId);u||(u=i.createVb(t),this.vbId=u.id,this.vbBuffer=null,this.modificationMarker=0);u.vao.bind();u=u.vb,u.bind();var l=r.length/9*o.vertPerQuad;if(this.modificationMarker!=l){this.modificationMarker=l;var p=o.stride*l;if(!this.vbBuffer||this.vbBuffer.byteLength<p){for(var c=o.stride;p>c;)c*=2;this.vbBuffer=new ArrayBuffer(c),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),u.upload(this.vbBuffer,0,!0)}var d,f,v,m=this.vbArray,x=(this.vbInts,0);if(t)for(h=0;h<r.length;h+=9)d=r[h+8]>>2,f=1024*(1&r[h+8]),v=1024*(r[h+8]>>1&1),m[x++]=r[h+2],m[x++]=r[h+3],m[x++]=r[h+0]+f,m[x++]=r[h+1]+v,m[x++]=r[h+4],m[x++]=r[h+6],m[x++]=r[h+7],m[x++]=d;else{for(h=0;h<r.length;h+=9){d=r[h+8]>>2,f=1024*(1&r[h+8]),v=1024*(r[h+8]>>1&1);var y=r[h+2],g=r[h+3],b=r[h+4],T=r[h+5],I=r[h]+f,S=r[h+1]+v,A=r[h+6],C=r[h+7];m[x++]=y,m[x++]=g,m[x++]=I,m[x++]=S,m[x++]=A,m[x++]=C,m[x++]=d,m[x++]=y+b,m[x++]=g,m[x++]=I+b,m[x++]=S,m[x++]=A,m[x++]=C,m[x++]=d,m[x++]=y+b,m[x++]=g+T,m[x++]=I+b,m[x++]=S+T,m[x++]=A,m[x++]=C,m[x++]=d,m[x++]=y,m[x++]=g,m[x++]=I,m[x++]=S,m[x++]=A,m[x++]=C,m[x++]=d,m[x++]=y+b,m[x++]=g+T,m[x++]=I+b,m[x++]=S+T,m[x++]=A,m[x++]=C,m[x++]=d,m[x++]=y,m[x++]=g+T,m[x++]=I,m[x++]=S+T,m[x++]=A,m[x++]=C,m[x++]=d}}u.upload(m,0,!0)}t?n.drawArrays(n.POINTS,0,l):n.drawArrays(n.TRIANGLES,0,l)}}},t.exports=i},{}],5:[function(e,t,r){function i(e,t){PIXI.Shader.call(this,e,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\n\nattribute vec2 aTextureCoord;\n\nattribute vec2 aAnim;\n\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nuniform vec2 animationFrame;\n\nvarying vec2 vTextureCoord;\n\nvarying float vTextureId;\n\nvoid main(void){\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord + aAnim * animationFrame;\n\n   vTextureId = aTextureId;\n\n}\n\n",n.generateFragmentSrc(t,"#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nvarying float vTextureId;\n\nuniform vec4 shadowColor;\n\nuniform sampler2D uSamplers[%count%];\n\nuniform vec2 uSamplerSize[%count%];\n\nvoid main(void){\n\n   vec2 textureCoord = vTextureCoord;\n\n   vec4 color;\n\n   %forloop%\n\n   gl_FragColor = color;\n\n}\n\n")),this.maxTextures=t,this.vertSize=7,this.vertPerQuad=6,this.stride=4*this.vertSize,n.fillSamplers(this,this.maxTextures)}var n=e("./shaderGenerator");i.prototype=Object.create(PIXI.Shader.prototype),i.prototype.constructor=i,i.prototype.createVao=function(e,t){var r=e.gl;return e.createVao().addIndex(this.indexBuffer).addAttribute(t,this.attributes.aVertexPosition,r.FLOAT,!1,this.stride,0).addAttribute(t,this.attributes.aTextureCoord,r.FLOAT,!1,this.stride,8).addAttribute(t,this.attributes.aAnim,r.FLOAT,!1,this.stride,16).addAttribute(t,this.attributes.aTextureId,r.FLOAT,!1,this.stride,24)},t.exports=i},{"./shaderGenerator":10}],6:[function(e,t,r){function i(e,t){PIXI.Shader.call(this,e,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\n\nattribute vec2 aTextureCoord;\n\nattribute vec2 aAnim;\n\nattribute float aTextureId;\n\nattribute float aSize;\n\nuniform mat3 projectionMatrix;\n\nuniform vec2 samplerSize;\n\nuniform vec2 animationFrame;\n\nuniform float projectionScale;\n\nvarying vec2 vTextureCoord;\n\nvarying float vSize;\n\nvarying float vTextureId;\n\nvoid main(void){\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition + aSize * 0.5, 1.0)).xy, 0.0, 1.0);\n\n   gl_PointSize = aSize * projectionScale;\n\n   vTextureCoord = aTextureCoord + aAnim * animationFrame;\n\n   vTextureId = aTextureId;\n\n   vSize = aSize;\n\n}\n\n",n.generateFragmentSrc(t,"#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nvarying float vSize;\n\nvarying float vTextureId;\n\nuniform vec4 shadowColor;\n\nuniform sampler2D uSamplers[%count%];\n\nuniform vec2 uSamplerSize[%count%];\n\nuniform vec2 pointScale;\n\nvoid main(void){\n\n   float margin = 1.0/vSize;\n\n   vec2 clamped = vec2(clamp(gl_PointCoord.x, margin, 1.0 - margin), clamp(gl_PointCoord.y, margin, 1.0 - margin));\n\n   vec2 textureCoord = ((clamped-0.5) * pointScale + 0.5) * vSize + vTextureCoord;\n\n   vec4 color;\n\n   %forloop%\n\n   gl_FragColor = color;\n\n}\n\n")),this.maxTextures=t,this.vertSize=8,this.vertPerQuad=1,this.stride=4*this.vertSize,n.fillSamplers(this,this.maxTextures)}var n=e("./shaderGenerator");i.prototype=Object.create(PIXI.Shader.prototype),i.prototype.constructor=i,i.prototype.createVao=function(e,t){var r=e.gl;return e.createVao().addIndex(this.indexBuffer).addAttribute(t,this.attributes.aVertexPosition,r.FLOAT,!1,this.stride,0).addAttribute(t,this.attributes.aTextureCoord,r.FLOAT,!1,this.stride,8).addAttribute(t,this.attributes.aSize,r.FLOAT,!1,this.stride,16).addAttribute(t,this.attributes.aAnim,r.FLOAT,!1,this.stride,20).addAttribute(t,this.attributes.aTextureId,r.FLOAT,!1,this.stride,28)},t.exports=i},{"./shaderGenerator":10}],7:[function(e,t,r){function i(e){PIXI.ObjectRenderer.call(this,e),this.vbs={},this.lastTimeCheck=0,this.tileAnim=[0,0],this.maxTextures=4,this.indices=new Uint16Array([0,1,2,0,2,3])}var n=e("./RectTileShader"),o=e("./SquareTileShader"),a=PIXI.glCore;i.prototype=Object.create(PIXI.ObjectRenderer.prototype),i.prototype.constructor=i,i.vbAutoincrement=0,i.prototype.onContextChange=function(){var e=this.renderer.gl,t=this.maxTextures;this.rectShader=new n(e,t),this.squareShader=new o(e,t),this.indexBuffer=a.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.rectShader.indexBuffer=this.indexBuffer,this.squareShader.indexBuffer=this.indexBuffer,this.vbs={},this.glTextures=[],this.boundSprites=[],this.initBounds()},i.prototype.initBounds=function(){var e=this.renderer.gl,t=document.createElement("canvas");t.width=2048,t.height=2048;for(var r=0;r<this.maxTextures;r++){var i=new a.GLTexture(e,2048,2048);i.premultiplyAlpha=!0,i.upload(t),i.enableWrapClamp(),i.enableLinearScaling(),this.glTextures.push(i);for(var n=[],o=0;4>o;o++){var s=new PIXI.Sprite;s.position.x=1024*(1&o),s.position.y=1024*(o>>1),n.push(s)}this.boundSprites.push(n)}},a.GLTexture.prototype._hackSubImage=function(e){this.bind();var t=this.gl,r=e.texture.baseTexture;t.texSubImage2D(t.TEXTURE_2D,0,e.position.x,e.position.y,this.format,this.type,r.source)},i.prototype.bindTextures=function(e,t){var r=this.boundSprites,i=this.glTextures,n=t.length,o=this.maxTextures;if(!(n>=4*o)){var a;for(a=0;n>a;a++){var s=t[a];if(e.bindTexture(s),s&&t[a].valid){var h=r[a>>2][3&a];if(h.texture!==s){h.texture=s;var u=i[a>>2];u._hackSubImage(h)}}}for(a=0;o>a;a++)i[a].bind(a);e._activeTextureLocation=o-1}},i.prototype.checkLeaks=function(){var e=Date.now(),t=e-1e4;if(this.lastTimeCheck<t||this.lastTimeCheck>e){this.lastTimeCheck=e;var r=this.vbs;for(var i in r)r[i].lastTimeAccess<t&&this.removeVb(i)}},i.prototype.start=function(){this.renderer.state.setBlendMode(PIXI.BLEND_MODES.NORMAL)},i.prototype.getVb=function(e){this.checkLeaks();var t=this.vbs[e];return t?(t.lastAccessTime=Date.now(),t):null},i.prototype.createVb=function(e){var t=++i.vbAutoincrement,r=this.getShader(e),n=this.renderer.gl,o=PIXI.glCore.GLBuffer.createVertexBuffer(n,null,n.STREAM_DRAW),a={id:t,vb:o,vao:r.createVao(this.renderer,o),lastTimeAccess:Date.now(),useSquare:e,shader:r};return this.vbs[t]=a,a},i.prototype.removeVb=function(e){this.vbs[e]&&(this.vbs[e].vb.destroy(),this.vbs[e].vao.destroy(),delete this.vbs[e])},i.prototype.getShader=function(e){return e?this.squareShader:this.rectShader},i.prototype.destroy=function(){PIXI.ObjectRenderer.prototype.destroy.call(this),this.rectShader.destroy(),this.squareShader.destroy(),this.rectShader=null,this.squareShader=null},PIXI.WebGLRenderer.registerPlugin("tile",i),t.exports=i},{"./RectTileShader":5,"./SquareTileShader":6}],8:[function(e,t,r){function i(){this.initialize.apply(this,arguments)}i.prototype=Object.create(PIXI.Container.prototype),i.prototype.initialize=function(e,t){PIXI.Container.apply(this,arguments),this.tilemap=e,this.z=t},i.prototype.clear=function(){for(var e=this.children,t=0;t<e.length;t++)e[t].clear();this._previousLayers=0},i.prototype.cacheIfDirty=function(){var e=this.tilemap,t=this.children,r=this._previousLayers!=t.length;this._previousLayers=t.length;var i=this.canvasBuffer,n=this._tempRender;i||(i=this.canvasBuffer=document.createElement("canvas"),n=this._tempRender=new PIXI.CanvasRenderer(100,100,{view:i}),n.context=n.rootContext,n.dontUseTransform=!0),i.width==e._layerWidth&&i.height==e._layerHeight||(i.width=e._layerWidth,i.height=e._layerHeight,r=!0);var o;if(!r)for(o=0;o<t.length;o++)if(t[o].isModified(this._lastAnimationFrame!=e.animationFrame)){r=!0;break}if(this._lastAnimationFrame=e.animationFrame,r)for(e._hackRenderer&&e._hackRenderer(n),n.context.clearRect(0,0,i.width,i.height),o=0;o<t.length;o++)t[o].clearModify(),t[o].renderCanvas(n);for(this.layerTransform=this.worldTransform,o=0;o<t.length;o++){this.layerTransform=t[o].worldTransform;break}},i.prototype.renderCanvas=function(e){this.cacheIfDirty();var t=this.layerTransform;e.context.setTransform(t.a,t.b,t.c,t.d,t.tx*e.resolution,t.ty*e.resolution);this.tilemap;e.context.drawImage(this.canvasBuffer,0,0)},t.exports=i},{}],9:[function(e,t,r){PIXI.tilemap={ZLayer:e("./ZLayer"),GraphicsLayer:e("./GraphicsLayer"),RectTileLayer:e("./RectTileLayer"),CompositeRectTileLayer:e("./CompositeRectTileLayer"),CanvasTileRenderer:e("./CanvasTileRenderer"),TileRenderer:e("./TileRenderer")},t.exports=PIXI.tilemap},{"./CanvasTileRenderer":1,"./CompositeRectTileLayer":2,"./GraphicsLayer":3,"./RectTileLayer":4,"./TileRenderer":7,"./ZLayer":8}],10:[function(e,t,r){var i={fillSamplers:function(e,t){for(var r=[],i=0;t>i;i++)r[i]=i;e.bind(),e.uniforms.uSamplers=r;var n=[];for(i=0;t>i;i++)n.push(1/2048),n.push(1/2048);e.uniforms.uSamplerSize=n},generateFragmentSrc:function(e,t){return t.replace(/%count%/gi,e).replace(/%forloop%/gi,this.generateSampleSrc(e))},generateSampleSrc:function(e){var t="";t+="\n",t+="\n",t+="if(vTextureId <= -1.0) {",t+="\n	color = shadowColor;",t+="\n}";for(var r=0;e>r;r++)t+="\nelse ",e-1>r&&(t+="if(vTextureId == "+r+".0)"),t+="\n{",t+="\n	color = texture2D(uSamplers["+r+"], textureCoord * uSamplerSize["+r+"]);",t+="\n}";return t+="\n",t+="\n"}};t.exports=i},{}]},{},[9]);
//# sourceMappingURL=pixi-tilemap.min.js.map
